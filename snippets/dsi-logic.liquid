<script>
    (function() {
        function initDSI() {
            console.log("DSI: Initializing...");
            // --- CONFIGURATION ---
            const urlParams = new URLSearchParams(window.location.search);
            const rawIntent = urlParams.get('user_intent');
            
            console.log("DSI: Raw Intent:", rawIntent);

            // If no intent, do nothing
            if (!rawIntent) return;

            const intent = decodeURIComponent(rawIntent).toLowerCase();
            console.log("DSI: Parsed Intent:", intent);
            
            const headlineEl = document.getElementById('lp-headline');
            const subheadEl = document.getElementById('lp-subhead');

            console.log("DSI: Elements found?", { headline: !!headlineEl, subhead: !!subheadEl });

            // Helper function to update text
            function updateContent(h1, h2) {
                console.log("DSI: Updating content...", { h1, h2 });
                if (headlineEl) headlineEl.innerHTML = h1;
                if (subheadEl) subheadEl.innerHTML = h2;
            }

            // --- LOGIC HIERARCHY ---

            // Priority 1: URGENCY
            const urgencyKeywords = ["rush", "minute", "urgent", "fast", "overnight", "emergency", "tomorrow", "tonight", "forgot"];
            if (urgencyKeywords.some(keyword => intent.includes(keyword))) {
                if (intent.includes("anniversary")) {
                    updateContent(
                        "You Didn't Forget. <br><span class='text-gold italic'>You Were Waiting for a Masterpiece.</span>",
                        "The ultimate anniversary rescue. Composed, recorded, and delivered tonight."
                    );
                } else {
                    updateContent(
                        "The Impossible Gift. <br><span class='text-gold italic'>Delivered Tonight.</span>",
                        "Don't just fill her hands with flowers. Fill her heart with a symphony. In your inbox by 8 PM."
                    );
                }
                return;
            }

            // Priority 2: APOLOGY
            const apologyKeywords = ["sorry", "apology", "doghouse"];
            if (apologyKeywords.some(keyword => intent.includes(keyword))) {
                if (intent.includes("wife")) {
                    updateContent(
                        "When \"Sorry\" Isn't Enough. <br><span class='text-gold italic'>Give Her a Symphony.</span>",
                        "Words failed you. Music won't. The only apology grand enough to bridge the silence."
                    );
                } else {
                    updateContent(
                        "Don't Just Apologize. <br><span class='text-gold italic'>Sweep Her Off Her Feet.</span>",
                        "Turn a mistake into a memory. The ultimate romantic gesture, delivered tonight."
                    );
                }
                return;
            }

            // Priority 3: COMPETITOR COMPARISON
            if (intent.includes("songfinch")) {
                updateContent(
                    "Don't Buy a Jingle. <br><span class='text-gold italic'>Commission a Legacy.</span>",
                    "Novelty gifts are for laughs. Broadcast-quality music is for love."
                );
                return;
            }

            // Priority 4: STATUS & SPECIFICS
            if (intent.includes("parent") || intent.includes("parents")) {
                updateContent(
                    "Honor Their Legacy. <br><span class='text-gold italic'>In Song.</span>",
                    "They have a lifetime of \"things.\" Give them a moment of pure emotion."
                );
                return;
            }

            if (intent.includes("birthday")) {
                updateContent(
                    "The Birthday Gift She’ll Remember <br><span class='text-gold italic'>When She’s 80.</span>",
                    "Perfume runs dry. Flowers wilt. A custom song is forever."
                );
                return;
            }

            const luxuryKeywords = ["luxury", "everything", "nothing", "sentimental"];
            if (luxuryKeywords.some(keyword => intent.includes(keyword))) {
                updateContent(
                    "She Has Everything. <br><span class='text-gold italic'>Except a Song Written Just For Her.</span>",
                    "Bespoke art, commissioned for her story. The only luxury that doesn't collect dust."
                );
                return;
            }

            // Priority 5: MILESTONES
            if (intent.includes("1st") || intent.includes("1 year")) {
                updateContent(
                    "One Year Down. <br><span class='text-gold italic'>A Lifetime to Go.</span>",
                    "Paper is traditional. This is eternal. A custom song for your first anniversary."
                );
                return;
            }

            if (intent.includes("5 year") || intent.includes("5th")) {
                updateContent(
                    "Five Years. Countless Memories. <br><span class='text-gold italic'>One Song.</span>",
                    "Tradition says 'Wood.' Love demands a Masterpiece."
                );
                return;
            }

            if (intent.includes("10 year") || intent.includes("10th")) {
                updateContent(
                    "A Decade of Love. <br><span class='text-gold italic'>One Defining Anthem.</span>",
                    "Ten years deserves more than tin. It deserves a legacy."
                );
                return;
            }

            if (intent.includes("25 year") || intent.includes("25th")) {
                updateContent(
                    "A Quarter Century. <br><span class='text-gold italic'>Immortalized.</span>",
                    "Diamonds sit in a drawer. This melody lives in the air between you."
                );
                return;
            }

            if (intent.includes("50 year") || intent.includes("50th")) {
                updateContent(
                    "Golden Era. <br><span class='text-gold italic'>Immortalized.</span>",
                    "Diamonds sit in a drawer. This melody lives in the air between you."
                );
                return;
            }

            const milestoneRegex = /(\d+)\s*(year|th|nd|rd|st)/;
            if (milestoneRegex.test(intent)) {
                 updateContent(
                    "A Lifetime of Love. <br><span class='text-gold italic'>Captured in Song.</span>",
                    "Tradition suggests a gift. Love demands a Masterpiece."
                );
                return;
            }

            // Priority 6: DEFAULT
            updateContent(
                "Your Love Story. <br><span class='text-gold italic'>In Song.</span>",
                "The intimacy of a love letter. The emotional scale of a movie soundtrack. Composed exclusively for her."
            );
        }

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initDSI);
        } else {
            initDSI();
        }
    })();
</script>
