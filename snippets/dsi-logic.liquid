<script>
    (function() {
        function initDSI() {
            console.log("DSI: Initializing...");
            
            // Get user_intent from URL
            const urlParams = new URLSearchParams(window.location.search);
            const rawIntent = urlParams.get('user_intent');
            
            console.log("DSI: Raw Intent:", rawIntent);

            // Get elements
            const headlineEl = document.getElementById('lp-headline');
            const subheadEl = document.getElementById('lp-subhead');
            
            console.log("DSI: Elements found?", { headline: !!headlineEl, subhead: !!subheadEl });

            // If no intent, use default
            if (!rawIntent) {
                console.log("DSI: No intent detected, using default");
                updateContent(
                    "The Only Custom Gift Delivered Tomorrow.",
                    "Commission a custom song for your anniversary. Written by a professional composer. Ready in 24 hours."
                );
                return;
            }

            const intent = decodeURIComponent(rawIntent).toLowerCase();
            console.log("DSI: Parsed Intent:", intent);

            // Helper function to update content
            function updateContent(h1, h2) {
                console.log("DSI: Updating content...", { h1, h2 });
                if (headlineEl) headlineEl.innerHTML = h1;
                if (subheadEl) subheadEl.innerHTML = h2;
            }

            // PRIORITY 1: MILESTONE ANNIVERSARIES
            if (intent.includes("1st") || intent.includes("paper")) {
                updateContent(
                    "One Year Down. <br><span class='text-gold italic'>A Lifetime to Go.</span>",
                    "Paper is traditional. This is eternal. A custom song for your first anniversary."
                );
                return;
            }

            if (intent.includes("10th") || intent.includes("tin")) {
                updateContent(
                    "A Decade of Love. <br><span class='text-gold italic'>One Defining Anthem.</span>",
                    "Ten years deserves more than tin. It deserves a legacy."
                );
                return;
            }

            if (intent.includes("25th") || intent.includes("silver")) {
                updateContent(
                    "A Quarter Century. <br><span class='text-gold italic'>Immortalized.</span>",
                    "Silver sits in a drawer. This melody lives in the air between you."
                );
                return;
            }

            if (intent.includes("50th") || intent.includes("gold")) {
                updateContent(
                    "Golden Era. <br><span class='text-gold italic'>Immortalized.</span>",
                    "Gold sits in a drawer. This melody lives in the air between you."
                );
                return;
            }

            // PRIORITY 2: JEWELRY KILLER
            const jewelryKeywords = ["jewelry", "necklace", "ring", "diamond", "earrings"];
            if (jewelryKeywords.some(keyword => intent.includes(keyword))) {
                updateContent(
                    "Better Than Diamond Earrings. <br><span class='text-gold italic'>Ready Tomorrow.</span>",
                    "Jewelry is cold. A custom song is forever. The ultimate anniversary gesture, composed by a world-class artist and delivered in 24 hours."
                );
                return;
            }

            // PRIORITY 3: LOGISTICAL PANIC
            const panicKeywords = ["same day", "tomorrow", "overnight", "rush", "24 hours"];
            if (panicKeywords.some(keyword => intent.includes(keyword))) {
                updateContent(
                    "The Only Custom Gift <br><span class='text-gold italic'>Delivered Tomorrow.</span>",
                    "Commission a classically trained composer today. Receive a studio-quality song by tomorrow evening. 100% Guaranteed Delivery."
                );
                return;
            }

            // PRIORITY 4: FORGOTTEN / GUILT
            const guiltKeywords = ["forgot", "missed", "late", "apology", "doghouse"];
            if (guiltKeywords.some(keyword => intent.includes(keyword))) {
                updateContent(
                    "You Didn't Forget. <br><span class='text-gold italic'>You Were Waiting for a Masterpiece.</span>",
                    "A generic gift says you panicked. A custom song says you planned this for months. Written by a professional artist, delivered tomorrow."
                );
                return;
            }

            // PRIORITY 5: LUXURY / SKEPTIC
            const luxuryKeywords = ["luxury", "expensive", "premium", "high end"];
            if (luxuryKeywords.some(keyword => intent.includes(keyword))) {
                updateContent(
                    "Classically Trained Quality. <br><span class='text-gold italic'>Delivered in 24 Hours.</span>",
                    "Don't buy a generic jingle. Commission a professional composer with decades of discipline to write your love story. The ultimate luxury experience."
                );
                return;
            }

            // DEFAULT (Fallback)
            updateContent(
                "The Only Custom Gift Delivered Tomorrow.",
                "Commission a custom song for your anniversary. Written by a professional composer. Ready in 24 hours."
            );
        }

        // Run on page load
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initDSI);
        } else {
            initDSI();
        }
    })();
</script>
