<script>
  (function() {
    try {
      // 1. Retrieve the intent we stored on the landing page
      var intent = localStorage.getItem('user_intent');

      // 2. Check if it exists and contains "anniversary"
      if (intent && intent.toLowerCase().indexOf('anniversary') !== -1) {
        
        // 3. Create a container for the form
        var container = document.createElement('div');
        container.style.marginTop = '30px';
        container.style.marginBottom = '30px';
        container.style.padding = '20px';
        container.style.background = '#ffffff';
        container.style.borderRadius = '8px';
        container.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
        
        // Optional: Add a header
        var header = document.createElement('h2');
        header.innerText = "Let's Get Started on Your Anniversary Song";
        header.style.textAlign = 'center';
        header.style.marginBottom = '20px';
        header.style.fontFamily = 'serif'; 
        container.appendChild(header);

        // 4. Inject the Tally Iframe
        var iframeContainer = document.createElement('div');
        iframeContainer.innerHTML = '<iframe data-tally-src="https://tally.so/embed/lbaXkv?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" loading="lazy" width="100%" height="202" frameborder="0" marginheight="0" marginwidth="0" title="Let\'s get started."></iframe>';
        container.appendChild(iframeContainer);
        
        // 5. Insert into the page
        // We try to find the main content area of the Order Status page
        var target = document.querySelector('.os-step__content') || document.querySelector('.content') || document.body;
        
        // Insert after the main content (or append to body as fallback)
        target.appendChild(container);

        // 6. Load the Tally Widget Script
        var d=document, w="https://tally.so/widgets/embed.js", v=function(){
          "undefined"!=typeof Tally ? Tally.loadEmbeds() : d.querySelectorAll("iframe[data-tally-src]:not([src])").forEach((function(e){e.src=e.dataset.tallySrc}))
        };
        if("undefined"!=typeof Tally) v();
        else if(d.querySelector('script[src="'+w+'"]')==null) {
          var s=d.createElement("script"); s.src=w; s.onload=v; s.onerror=v; d.body.appendChild(s);
        }
      }
    } catch(e) {
      console.error('Error injecting Tally form:', e);
    }
  })();
</script>
